<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Record HTTP Calls to Disk • vcr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Record HTTP Calls to Disk">
<meta property="og:description" content="Record test suite HTTP requests and replays them during
    future runs. A port of the Ruby gem of the same name
    (&lt;https://github.com/vcr/vcr/&gt;). Works by hooking into the webmockr
    R package for matching HTTP requests by various rules (HTTP method,
    URL, query parameters, headers, body, etc.), and then caching
    real HTTP responses on disk in cassettes. Subsequent HTTP requests
    matching any previous requests in the same cassette use a cached
    HTTP response.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">vcr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/vcr.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/configuration.html">vcr configuration</a>
    </li>
    <li>
      <a href="articles/request_matching.html">request matching</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/vcr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<div id="vcr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#vcr" class="anchor"></a>vcr</h1></div>

<p>An R port of the Ruby gem <a href="https://github.com/vcr/vcr">vcr</a></p>
<div id="docs" class="section level2">
<h2 class="hasAnchor">
<a href="#docs" class="anchor"></a>Docs</h2>
<p>Check out the <a href="https://ropenscilabs.github.io/http-testing-book/">HTTP testing book</a> and the <a href="vignettes">vcr vignettes</a>.</p>
</div>
<div id="supported-http-libraries" class="section level2">
<h2 class="hasAnchor">
<a href="#supported-http-libraries" class="anchor"></a>Supported HTTP libraries</h2>
<ul>
<li><a href="https://github.com/ropensci/crul">crul</a></li>
<li><a href="https://github.com/r-lib/httr">httr</a></li>
</ul>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(vcr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(crul)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">cli &lt;-<span class="st"> </span>crul<span class="op">::</span>HttpClient<span class="op">$</span><span class="kw">new</span>(<span class="dt">url =</span> <span class="st">"https://eu.httpbin.org"</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="kw"><a href="reference/use_cassette.html">use_cassette</a></span>(<span class="dt">name =</span> <span class="st">"helloworld"</span>, {</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">    cli<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"get"</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  })</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt;   0.112   0.010   0.501</span></a></code></pre></div>
<p>The request gets recorded, and all subsequent requests of the same form used the cached HTTP response, and so are much faster</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="kw"><a href="reference/use_cassette.html">use_cassette</a></span>(<span class="dt">name =</span> <span class="st">"helloworld"</span>, {</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    cli<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"get"</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  })</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;   0.070   0.005   0.076</span></a></code></pre></div>
<p>Importantly, your unit test deals with the same inputs and the same outputs - but behind the scenes you use a cached HTTP response - thus, your tests run faster.</p>
<p>The cached response looks something like (condensed for brevity):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="fu">http_interactions:</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></span> <span class="fu">request:</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    <span class="fu">method:</span><span class="at"> get</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="fu">uri:</span><span class="at"> https://eu.httpbin.org/get</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    <span class="fu">body:</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">      <span class="fu">encoding:</span><span class="at"> </span><span class="st">''</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">      <span class="fu">string:</span><span class="at"> </span><span class="st">''</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    <span class="fu">headers:</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">      <span class="fu">User-Agent:</span><span class="at"> libcurl/7.54.0 r-curl/3.2 crul/0.5.2</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  <span class="fu">response:</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    <span class="fu">status:</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">      <span class="fu">status_code:</span><span class="at"> </span><span class="st">'200'</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13">      <span class="fu">message:</span><span class="at"> OK</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">      <span class="fu">explanation:</span><span class="at"> Request fulfilled, document follows</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15">    <span class="fu">headers:</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16">      <span class="fu">status:</span><span class="at"> HTTP/1.1 200 OK</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17">      <span class="fu">connection:</span><span class="at"> keep-alive</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">    <span class="fu">body:</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19">      <span class="fu">encoding:</span><span class="at"> UTF-8</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20">      <span class="fu">string:</span><span class="at"> </span><span class="st">"{\n  \"</span><span class="er">args\": {}, \n  \"headers\": {\n    \"Accept\": \"application/json,</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21">        <span class="fu">text/xml, application/xml, */*\", \n    \"Accept-Encoding\":</span><span class="at"> \"gzip, deflate\",</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22">        <span class="fu">\n    \"Connection\":</span><span class="at"> \"close\", \n    \"Host\": \"httpbin.org\", \n    \"User-Agent\":</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23">        <span class="fu">\"libcurl/7.54.0 r-curl/3.2 crul/0.5.2\"\n  }, \n  \"origin\":</span><span class="at"> \"111.222.333.444\",</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24">        <span class="fu">\n  \"url\":</span><span class="at"> \"https://eu.httpbin.org/get\"\n}\n"</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25">  <span class="fu">recorded_at:</span><span class="at"> 2018-04-03 22:55:02 GMT</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26">  <span class="fu">recorded_with:</span><span class="at"> vcr/0.1.0, webmockr/0.2.4, crul/0.5.2</span></a></code></pre></div>
<p>All components of both the request and response are preserved, so that the HTTP client (in this case <code>crul</code>) can reconstruct its own response just as it would if it wasn’t using <code>vcr</code>.</p>
</div>
<div id="terminology" class="section level2">
<h2 class="hasAnchor">
<a href="#terminology" class="anchor"></a>Terminology</h2>
<ul>
<li>
<em>vcr</em>: the name comes from the idea that we want to record something and play it back later, like a vcr</li>
<li>
<em>cassette</em>: A <em>thing</em> to record HTTP interactions to. Right now the only option is file system, but in the future could be other things, e.g. a key-value store like Redis</li>
<li>Persisters: defines how to save requests - currently only option is the file system</li>
<li>Serializers: defines how to serialize the HTTP response - currently only option is YAML; other options in the future could include e.g. JSON</li>
<li>
<em>insert cassette</em>: create a cassette (all HTTP interactions will be recorded to this cassette)</li>
<li>
<em>eject cassette</em>: eject the cassette (no longer recording to that cassette)</li>
<li>
<em>replay</em>: refers to using a cached result of an http request that was recorded earlier</li>
</ul>
</div>
<div id="what-does-vcr-do" class="section level2">
<h2 class="hasAnchor">
<a href="#what-does-vcr-do" class="anchor"></a>What does vcr do?</h2>
<p>The short version is: <code>vcr</code> helps you stub HTTP requests so you don’t have to repeat HTTP requests.</p>
<p>The main use case is for unit tests for R packages.</p>
<p><code>vcr</code> currently works with the <code>crul</code> and <code>httr</code> packages; support for <code>curl</code> is in the works.</p>
<div id="how-it-works-in-lots-of-detail" class="section level3">
<h3 class="hasAnchor">
<a href="#how-it-works-in-lots-of-detail" class="anchor"></a>How it works in lots of detail</h3>
<p><strong>The Steps</strong></p>
<ol style="list-style-type: decimal">
<li>Use either <code><a href="reference/use_cassette.html">vcr::use_cassette</a></code> or <code><a href="reference/insert_cassette.html">vcr::insert_cassette</a></code>
</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>If you use <code><a href="reference/insert_cassette.html">vcr::insert_cassette</a></code>, make sure to run <code><a href="reference/eject_cassette.html">vcr::eject_cassette</a></code> when you’re done to stop recording</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>When you first run a request with <code>vcr</code> there’s no cached data to use, so we allow HTTP requests until you’re request is done.</li>
<li>Before we run the real HTTP request, we “stub” the request with <code>webmockr</code> so that future requests will match the stub. This stub is an R6 class with details of the interaction (request + response), but is not on disk.</li>
<li>After the stub is made, we run the real HTTP request.</li>
<li>We then disallow HTTP requests so that if the request is done again we use the cached response</li>
<li>The last thing we do is write the HTTP interaction to disk in a mostly human readable form.</li>
</ol>
<p>When you run that request again using <code><a href="reference/use_cassette.html">vcr::use_cassette</a></code> or <code><a href="reference/insert_cassette.html">vcr::insert_cassette</a></code>:</p>
<ul>
<li>We use <code>webmockr</code> to match the request to cached requests, and since we stubbed the request the first time we used the cached response.</li>
</ul>
<p>Of course if you do a different request, even slightly (but depending on which matching format you decided to use), then the request will have no matching stub and no cached response, and then a real HTTP request is done - we then cache it, then subsequent requests will pull from that cached response.</p>
<p><code>webmockr</code> has adapters for each R client (again, right now only <a href="https://github.com/ropensci/crul">crul</a>) - so that we actually intercept HTTP requests when <code>webmockr</code> is loaded and the user turns it on. So, <code>webmockr</code> doesn’t actually require an internet or localhost connection at all, but can do its thing just fine by matching on whatever the user requests to match on. In fact, <code>webmockr</code> doesn’t allow real HTTP requests by default, but can be toggled off of course.</p>
<p>The main use case we are going for in <code>vcr</code> is to deal with real HTTP requests and responses, so we allow real HTTP requests when we need to, and turn it off when we don’t.</p>
<p>This gives us a very flexible and powerful framework where we can support <code>webmockr</code> and <code>vcr</code> integration for any number of R clients for HTTP requests and support many different formats serialized to disk.</p>
</div>
<div id="just-want-to-mock-and-not-store-on-disk" class="section level3">
<h3 class="hasAnchor">
<a href="#just-want-to-mock-and-not-store-on-disk" class="anchor"></a>Just want to mock and not store on disk?</h3>
<p>You’re looking for <a href="https://github.com/ropensci/webmockr">webmockr</a>. <code>webmockr</code> only matches requests based on criteria you choose, but does not cache HTTP interactions to disk as <code>vcr</code> does.</p>
<p><br></p>
</div>
</div>
<div id="best-practices" class="section level2">
<h2 class="hasAnchor">
<a href="#best-practices" class="anchor"></a>Best practices</h2>
<div id="vcr-for-tests" class="section level3">
<h3 class="hasAnchor">
<a href="#vcr-for-tests" class="anchor"></a>vcr for tests</h3>
<ul>
<li>Add <code>vcr</code> to <code>Suggests</code> in your DESCRIPTION file (optionally add <code>webmockr</code>, but it’s not explicitly needed as <code>vcr</code> will pull it in)</li>
<li>Make a file in your <code>tests/testthat/</code> directory called <code>helper-yourpackage.R</code> (or skip if as similar file already exists). In that file use the following lines to setup your path for storing cassettes (change path to whatever you want):</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"vcr"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(vcr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/vcr/man/vcr_configure.html">vcr_configure</a></span>())</a></code></pre></div>
<ul>
<li>In your tests, for whichever tests you want to use <code>vcr</code>, wrap them in a <code><a href="reference/use_cassette.html">vcr::use_cassette()</a></code> call like:</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(testthat)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">vcr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/vcr/man/use_cassette.html">use_cassette</a></span>(<span class="st">"rl_citation"</span>, {</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="kw"><a href="https://rdrr.io/pkg/testthat/man/test_that.html">test_that</a></span>(<span class="st">"my test"</span>, {</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    aa &lt;-<span class="st"> </span><span class="kw">rl_citation</span>()</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">    <span class="kw"><a href="https://rdrr.io/pkg/testthat/man/expect_is.html">expect_is</a></span>(aa, <span class="st">"character"</span>)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">    <span class="kw"><a href="https://rdrr.io/pkg/testthat/man/expect_match.html">expect_match</a></span>(aa, <span class="st">"IUCN"</span>)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">    <span class="kw"><a href="https://rdrr.io/pkg/testthat/man/expect_match.html">expect_match</a></span>(aa, <span class="st">"www.iucnredlist.org"</span>)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  })</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">})</a></code></pre></div>
<p>OR put the <code><a href="reference/use_cassette.html">vcr::use_cassette()</a></code> block on the inside, but put <code>testthat</code> expectations outside of the <code><a href="reference/use_cassette.html">vcr::use_cassette()</a></code> block:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(testthat)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/pkg/testthat/man/test_that.html">test_that</a></span>(<span class="st">"my test"</span>, {</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  vcr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/vcr/man/use_cassette.html">use_cassette</a></span>(<span class="st">"rl_citation"</span>, {</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    aa &lt;-<span class="st"> </span><span class="kw">rl_citation</span>()</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  })</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  <span class="kw"><a href="https://rdrr.io/pkg/testthat/man/expect_is.html">expect_is</a></span>(aa, <span class="st">"character"</span>)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">  <span class="kw"><a href="https://rdrr.io/pkg/testthat/man/expect_match.html">expect_match</a></span>(aa, <span class="st">"IUCN"</span>)</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">  <span class="kw"><a href="https://rdrr.io/pkg/testthat/man/expect_match.html">expect_match</a></span>(aa, <span class="st">"www.iucnredlist.org"</span>)</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">})</a></code></pre></div>
<p>Don’t wrap the <code><a href="reference/use_cassette.html">use_cassette()</a></code> block inside your <code><a href="https://rdrr.io/pkg/testthat/man/test_that.html">test_that()</a></code> block with <code>testthat</code> expectations inside the <code><a href="reference/use_cassette.html">use_cassette()</a></code> block, as you’ll only get the line number that the <code><a href="reference/use_cassette.html">use_cassette()</a></code> block starts on on failures.</p>
<ul>
<li>When running tests or checks of your whole package, note that some users have found different results with <code><a href="https://rdrr.io/pkg/devtools/man/check.html">devtools::check()</a></code> vs. <code><a href="https://rdrr.io/pkg/devtools/man/test.html">devtools::test()</a></code>. It’s not clear why this would make a difference. Do let us know if you run into this problem.</li>
</ul>
</div>
<div id="vcr-in-your-r-project" class="section level3">
<h3 class="hasAnchor">
<a href="#vcr-in-your-r-project" class="anchor"></a>vcr in your R project</h3>
<p>You can use <code>vcr</code> in an R project as well.</p>
<ul>
<li>Load <code>vcr</code> in your project</li>
<li>Similar to the above example, use <code>use_cassette</code> to run code that does HTTP requests.</li>
<li>The first time a real request is done, and after that the cached response will be used.</li>
</ul>
</div>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>CRAN version:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"vcr"</span>)</a></code></pre></div>
<p>Development version:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/reexports.html">install_github</a></span>(<span class="st">"ropensci/vcr"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"vcr"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"crul"</span>)</a></code></pre></div>
</div>
<div id="configuration" class="section level2">
<h2 class="hasAnchor">
<a href="#configuration" class="anchor"></a>Configuration</h2>
<p>We set the following defaults:</p>
<ul>
<li>
<code>dir</code> = “.”</li>
<li>
<code>record</code> = “once”</li>
<li>
<code>match_requests_on</code> = <code><a href="https://rdrr.io/r/base/c.html">c("method", "uri")</a></code>
</li>
<li>
<code>allow_unused_http_interactions</code> = <code>TRUE</code>
</li>
<li>
<code>serialize_with</code> = <code>"yaml"</code>
</li>
<li>
<code>persist_with</code> = <code>"FileSystem"</code>
</li>
<li>
<code>ignore_hosts</code> = <code>NULL</code>
</li>
<li>
<code>ignore_localhost</code> = <code>FALSE</code>
</li>
<li>
<code>ignore_request</code> = <code>NULL</code>
</li>
<li>
<code>uri_parser</code> = <code><a href="https://rdrr.io/pkg/crul/man/url_build.html">crul::url_parse</a></code>
</li>
<li>
<code>preserve_exact_body_bytes</code> = <code>FALSE</code>
</li>
<li>
<code>turned_off</code> = <code>FALSE</code>
</li>
<li>
<code>ignore_cassettes</code> = <code>FALSE</code>
</li>
<li>
<code>re_record_interval</code> = <code>NULL</code>
</li>
<li>
<code>clean_outdated_http_interactions</code> = <code>NULL</code>
</li>
<li>
<code>cassettes</code> = <code><a href="https://rdrr.io/r/base/list.html">list()</a></code>
</li>
<li>
<code>linked_context</code> = <code>NULL</code>
</li>
<li>
<code>vcr_logging</code> = <code>"vcr.log"</code>
</li>
<li>
<code>vcr_logging_opts</code> = <code><a href="https://rdrr.io/r/base/list.html">list()</a></code>
</li>
</ul>
<p>You can get the defaults programmatically with</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="reference/vcr_configure.html">vcr_config_defaults</a></span>()</a></code></pre></div>
<p>You can change all the above defaults with <code><a href="reference/vcr_configure.html">vcr_configure()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="reference/vcr_configure.html">vcr_configure</a></span>()</a></code></pre></div>
<p>Calling <code><a href="reference/vcr_configure.html">vcr_configuration()</a></code> gives you some of the more important defaults in a nice tidy print out</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="reference/vcr_configure.html">vcr_configuration</a></span>()</a></code></pre></div>
<!-- `use_cassette()` is an easier approach. An alternative is to use
`insert_cassett()` + `eject_cassette()`.

`use_cassette()` does both insert and eject operations for you, but
you can instead do them manually by using the above functions. You do have
to eject the cassette after using insert. -->
</div>
<div id="matchingmatchers" class="section level2">
<h2 class="hasAnchor">
<a href="#matchingmatchers" class="anchor"></a>Matching/Matchers</h2>
<p><code>vcr</code> looks for similarity in your HTTP requests to cached requests. You can set what is examined about the request with one or more of the following options:</p>
<ul>
<li><code>body</code></li>
<li><code>headers</code></li>
<li><code>host</code></li>
<li><code>method</code></li>
<li><code>path</code></li>
<li><code>query</code></li>
<li><code>uri</code></li>
</ul>
<p>By default, we use <code>method</code> (HTTP method, e.g., <code>GET</code>) and <code>uri</code> (test for exact match against URI, e.g., <code>http://foo.com</code>).</p>
<p>You can set your own options by tweaking the <code>match_requests_on</code> parameter:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="reference/use_cassette.html">use_cassette</a></span>(<span class="dt">name =</span> <span class="st">"one"</span>, {</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">    cli<span class="op">$</span><span class="kw">post</span>(<span class="st">"post"</span>, <span class="dt">body =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">a =</span> <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  },</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  <span class="dt">match_requests_on =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'method'</span>, <span class="st">'headers'</span>, <span class="st">'body'</span>)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">)</a></code></pre></div>
</div>
<div id="vcr-in-other-languages" class="section level2">
<h2 class="hasAnchor">
<a href="#vcr-in-other-languages" class="anchor"></a>vcr in other languages</h2>
<p>The canonical <code>vcr</code> (in Ruby) lists ports in other languages at <a href="https://github.com/vcr/vcr" class="uri">https://github.com/vcr/vcr</a></p>
</div>
<div id="note" class="section level2">
<h2 class="hasAnchor">
<a href="#note" class="anchor"></a>NOTE</h2>
<p>There’s a number of features in this package that are not yet supported, but for which their parameters are found in the package. For example, <code>decode_compressed_response</code> is a parameter in <code><a href="reference/use_cassette.html">use_cassette()</a></code> but it is ignored right now.</p>
<p>We’ve tried to make sure the parameters that are ignored are marked as such. Keep an eye out for package updates for changes in these parameters, and/or let us know you want it and we can move it up in the priority list.</p>
</div>
<div id="example-packages-using-vcr" class="section level2">
<h2 class="hasAnchor">
<a href="#example-packages-using-vcr" class="anchor"></a>Example packages using vcr</h2>
<ul>
<li><a href="https://github.com/ropensci/rgbif">rgbif</a></li>
<li><a href="https://github.com/ropensci/rredlist">rredlist</a></li>
<li><a href="https://github.com/ropensci/bold">bold</a></li>
<li><a href="https://github.com/ropensci/wikitaxa">wikitaxa</a></li>
<li><a href="https://github.com/ropensci/worrms">worrms</a></li>
<li><a href="https://github.com/ropensci/microdemic">microdemic</a></li>
<li><a href="https://github.com/ropenscilabs/zbank">zbank</a></li>
<li><a href="https://github.com/ropensci/rplos">rplos</a></li>
<li><a href="https://github.com/ropensci/ritis">ritis</a></li>
<li><a href="https://github.com/ropensci/nasapower">nasapower</a></li>
</ul>
</div>
<div id="todo" class="section level2">
<h2 class="hasAnchor">
<a href="#todo" class="anchor"></a>TODO</h2>
<ul>
<li>Logging</li>
<li>Provide toggling a re-record interval so you can say e.g., after 6 hrs, re-record a real response, updating the cached response</li>
<li>…</li>
</ul>
</div>
<div id="meta" class="section level2">
<h2 class="hasAnchor">
<a href="#meta" class="anchor"></a>Meta</h2>
<ul>
<li>Please <a href="https://github.com/ropensci/vcr/issues">report any issues or bugs</a>
</li>
<li>License: MIT</li>
<li>Get citation information for <code>vcr</code> in R doing <code><a href="https://rdrr.io/r/utils/citation.html">citation(package = 'vcr')</a></code>
</li>
<li>Please note that this project is released with a <a href="https://github.com/ropensci/vcr/blob/master/CODE_OF_CONDUCT.md">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</li>
</ul>
<p><a href="https://ropensci.org"><img src="https://ropensci.org/public_images/github_footer.png" alt="ropensci_footer"></a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=vcr">https://​cloud.r-project.org/​package=vcr</a>
</li>
<li>Browse source code at <br><a href="https://github.com/ropensci/vcr">https://​github.com/​ropensci/​vcr</a>
</li>
<li>Report a bug at <br><a href="https://github.com/ropensci/vcr/issues">https://​github.com/​ropensci/​vcr/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Scott Chamberlain <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1444-9135" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID"></a> </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cranchecks.info/pkgs/vcr"><img src="https://cranchecks.info/badges/worst/vcr" alt="cran checks"></a></li>
<li><a href="https://www.repostatus.org/#active"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a></li>
<li><a href="https://travis-ci.org/ropensci/vcr"><img src="https://travis-ci.org/ropensci/vcr.svg" alt="Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/sckott/vcr"><img src="https://ci.appveyor.com/api/projects/status/6sewc0t3bhdg5opo?svg=true" alt="Build status"></a></li>
<li><a href="https://codecov.io/gh/ropensci/vcr"><img src="https://codecov.io/gh/ropensci/vcr/branch/master/graph/badge.svg" alt="codecov"></a></li>
<li><a href="https://github.com/metacran/cranlogs.app"><img src="http://cranlogs.r-pkg.org/badges/vcr" alt="rstudio mirror downloads"></a></li>
<li><a href="https://cran.r-project.org/package=vcr"><img src="https://www.r-pkg.org/badges/version/vcr" alt="cran version"></a></li>
</ul>
</div>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Scott Chamberlain.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9100.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
